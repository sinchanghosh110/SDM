---
title: "Year and month wise ndm and sdm of blue-tailed bee-eater"
output:
  pdf_document: default
  html_document: default
---
This is the notebook for modelling the miratory niche year wise and month wise from importing the whole dataset to the point of processing it.

#Setting working directory
```{r}
setwd("D:/SDM_blue_tailed_bee_eater")
getwd()
```
#Downloading GBIF data
```{r}
# Load required libraries
library(rgbif)
library(dplyr)

# Define the taxonKey and date range
taxonKey <- 2475452
startYear <- 2019
endYear <- 2022

# Create an empty dataframe to store the combined data
combinedData2 <- data.frame()

# Loop through the years and months to download data
for (year in startYear:endYear) {
  for (month in 1:12) {
    # Download occurrence data for the given taxonKey, year, and month
    data= occ_search(taxonKey = taxonKey, 
                       year = year, 
                       month = month, 
                       limit = 10000)
    data=data$data
    data$lat=data$decimalLatitude
    data$lon=data$decimalLongitude
    df1=data[,c("lon", "lat", "month", "year")]
    if (!anyNA(df1$lon & df1$lat)) {
      # Add the downloaded data to the combinedData dataframe
      combinedData2 <- rbind(combinedData, df1)
    }
  }
}

# Save the combined data as a CSV file
write.csv(combinedData2, "newdata2.csv", row.names = FALSE)

# Print a message indicating that the data has been saved
#cat("Data has been saved as 'newdata.csv' file.\n")
```
#reading data for filtration
```{r}
library(readr)
newdata=read.csv("newdata.csv",header=T)
olddata=read.csv("dataset.csv",header=T)
df2=rbind(newdata,olddata)
#newdata$lat=newdata$decimalLatitude
#newdata$lon=newdata$decimalLongitude
df2=subset(df2,!lon==is.na(lon) & !lat==is.na(lat))
#newdata=subset(newdata,lat>18)
#min(newdata$lat);max(newdata$lat)
#min(newdata$decimalLongitude);max(newdata$decimalLongitude)

```


#Year and month wise data filtering

```{r}

for (i in 2010:2018) {
  for (j in 1:12) {
    assign(paste0(sprintf("%02d", j),"_", i), subset(df2,year==i & month == j ))
  }}
  

```

#Geographic extent
```{r}
library(raster)
library(dismo)
library(sp)

#newdata$lat=newdata$decimalLatitude
#newdata$lon=newdata$decimalLongitude
newdata=read.csv("newdata.csv",header=T)
olddata=read.csv("dataset.csv",header=T)
df2=rbind(newdata,olddata)
#newdata$lat=newdata$decimalLatitude
#newdata$lon=newdata$decimalLongitude
df2=subset(df2,!lon==is.na(lon) & !lat==is.na(lat))
max.lat <-ceiling(max(df2$lat)) 
min.lat <- floor(min(df2$lat))
max.lon <- ceiling(max(df2$lon))
min.lon <- floor(min(df2$lon))
geographic_extent=extent(x = c(min.lon, max.lon, min.lat, max.lat))
print(geographic_extent)

```

#Check the extent in the base map
```{r}
library(maptools)
data(wrld_simpl)
wrld_simpl
wrld_simpl=crop(wrld_simpl,geographic_extent)
plot(wrld_simpl)
```

#Taking only lattitudes and longitudes
```{r}


data_list <- list()

for (i in 2010:2018) {
  for (j in 1:12) {
    var_name <- paste0(sprintf("%02d", j),"_", i)
    data_name <- get(var_name)
    m_n=months[j]
    data_list[[var_name]] <- data_name[,c("lon", "lat")]
  }
}

# You can access the individual data frames using the list index, for example:
data_list[["01_2010"]]

```
#reading primary data
```{r}
primary_data=read.csv("primary data.csv",header=T)
primary_data=primary_data[,c("lon","lat")]
```
#merging data frames
```{r}

for (i in 2010:2018) {
  for (j in 4:9) {
    data_list[[paste0(sprintf("%02d", j),"_", i)]] <- rbind(data_list[[paste0(sprintf("%02d", j),"_", i)]], primary_data)
  }
}

for (var_name in names(data_list)) {
  if (!is.numeric(data_list[[var_name]])) {
    print(paste(var_name, "contains non-numeric data"))
  }
}

sum(is.na(data_list[["01_2010"]]$lat))

sapply(data_list, class)
library(readr)

data_list <- lapply(data_list, function(x) {
  if (is.character(x) && !is.numeric(x)) {
    parse_number(x)
  } else {
    x
  }
})
```
# create folder named "Combined data" in the working directory
```{r}
dir.create("Combined data v2")
```
#save each variable as a CSV file
```{r}
for (i in seq_along(data_list)) {
  var_name <- names(data_list)[i]
  file_name <- paste0("Combined data v2/", var_name, ".csv")
  write.csv(data_list[[i]], file = file_name, row.names = FALSE)
}




# Convert item names in bcdata_list to the format [two digits of months]_[four digits of year]


```

#Reading the csv files and convert them as sp data
```{r}
library(sp)

# Set the path to the directory where the CSV files are stored
data_dir <- "Combined data v2"

# Get the list of CSV files in the directory
data_files <- list.files(data_dir, full.names = TRUE)

# Create an empty list to store the spatial point data frames
sp_list <- list()

# Loop through the CSV files and create spatial point data frames
for (file in data_files) {
  # Extract the file name without the directory or extension
  sp_name <- gsub(".csv", "", basename(file))
  
  # Read the CSV file into a data frame
  data_df <- read.csv(file, header = TRUE, stringsAsFactors = FALSE)
  
  # Convert the data frame to a spatial point data frame
  sp_df <- SpatialPointsDataFrame(coords = data_df[, c("lon", "lat")],
                                   data = data_df,
                                   proj4string = CRS("+proj=longlat +datum=WGS84"))
  
  # Add the spatial point data frame to the list
  sp_list[[sp_name]] <- sp_df
}

# View the list of spatial point data frames
sp_list[["01_2010"]]

library(sp)
library(rgdal)
# Set the path to the directory where the CSV files are stored
data_dir <- "Combined data v2"

# Create the directory for the shapefiles
dir.create("combined_sp_dataframes v2")


# Loop through the CSV files and create spatial point data frames
for (file in list.files(data_dir, full.names = TRUE)) {
  # Extract the file name without the directory or extension
  sp_name <- paste0(gsub(".csv", "", basename(file)))

  # Read the CSV file into a data frame
  data_df <- read.csv(file, header = TRUE, stringsAsFactors = FALSE)

  # Convert the data frame to a spatial point data frame
  sp_df <- SpatialPointsDataFrame(coords = data_df[, c("lon", "lat")],
                                   data = data_df,
                                   proj4string = CRS("+proj=longlat +datum=WGS84"))

  # Save the spatial point data frame as a shapefile in the new directory
  if (file.exists(paste0("combined_sp_dataframes v2/", sp_name, ".shp"))) {
    # choose a new name for the layer
    print(paste0(sp_name, "already exists"))
  }
  writeOGR(sp_df, "combined_sp_dataframes v2", layer = sp_name, driver = "ESRI Shapefile")
}


```

#resampling to remove bias
```{r}
library(raster)
library(rgdal)
library(sp)
library(dismo)
# Set the path to the directory where the shapefiles are stored
shapefile_dir <- "combined_sp_dataframes v2"


# Loop through the shapefiles and resample data
for (file in list.files(shapefile_dir, full.names = TRUE, pattern = "\\.shp$")) {
  # Extract the file name without the directory or extension
  sp_name <- gsub(".shp", "", basename(file))
  
  # Read the shapefile into a spatial object
  shapefile_sp <- readOGR(file)
  raster_template=raster(shapefile_sp)
  # Resample the shapefile data to the raster grid
  resampled_data=gridSample(shapefile_sp, raster_template,n=1)
  
  # Convert the resampled data to a data frame
  resampled_df <- data.frame(ID = 1:length(resampled_data), resampled_data)
  # Save the resampled data as a CSV file with the same name as the shapefile
  write.csv(resampled_df,file.path(shapefile_dir,paste0(sp_name,".csv")),row.names = FALSE)}

```

#Bias corrected files as sp data frame
```{r}
library(sp)
library(rgdal)

# Set the path to the directory where the CSV files are stored
csv_dir <- "D:/SDM_blue_tailed_bee_eater/combined_sp_dataframes v2"

# Get the list of CSV files in the directory
csv_files <- list.files(csv_dir, pattern = "\\d{2}_\\d{4}\\.csv$", full.names = TRUE)

# Create an empty list to store the sp objects
bcdata_list <- list()

# Loop through the CSV files and read them into sp objects
for (file in csv_files) {
  # Extract the file name without the directory or extension
  name <- gsub(".csv", "", basename(file))
  
  # Read the CSV file into a data frame
  data <- read.csv(file, header = TRUE, stringsAsFactors = FALSE)
  
  # Create the spatial points data frame
  coordinates(data) <- c("coords.x1", "coords.x2")
  
  # Set the coordinate reference system
  proj4string(data) <- CRS("+proj=longlat +datum=WGS84")
  
  # Add the sp object to the list
  bcdata_list[[name]] <- data
}
bcdata_list[["01_2010"]]


```

#Read the climate data
```{r}
library(raster)
library(ncdf4)
library(rgdal)

# Define the path and variables
ncpath <- "D:/SDM_blue_tailed_bee_eater/"
variables <- c("pre", "tmp", "vap", "cld", "dtr", "wet", "frs", "pet")

# Create empty list to store rasters
rasters <- list()

# Loop through variables and read rasters
for (var in variables) {
  var_file <- paste0(ncpath, "cru_ts4.06.1901.2021.", var, ".dat.nc")
  var_raster <- brick(var_file, varname=var)
  rasters[[var]] <- var_raster
}

# Access the pet raste


```
#Cropping the climatic dataset
```{r}
library(rgeos)
variables <- c("pre", "tmp", "vap", "cld", "dtr", "wet", "frs", "pet")
data("wrld_simpl")
#wrld_simpl=crop(x=wrld_simpl,y=geographic_extent)
#projection(wrld_simpl) <- CRS('+proj=longlat +datum=WGS84')
for (var in variables) {
  rasters[[var]] =crop(x=rasters[[var]],y=geographic_extent)
}

#topo_up=crop(x=topo_up,y=geographic_extent)
#topo_up
```
#Setting coordinate referencing system
```{r}
variables <- c("pre", "tmp", "vap", "cld", "dtr", "wet", "frs", "pet")

for (var in variables) {
  crs(rasters[[var]]) =crs(wrld_simpl)
}

```

#year and month wise data processing
```{r}
variables <- c("pre", "tmp", "vap", "cld", "dtr", "wet", "frs", "pet")
years=2010:2018;months=1:12
bioclim_list=list()
year_list=list()
month_list=list()
for (var in variables) {
  for (year in years) {
    for (month in months) {
      if (month > 9) {
        vname <- paste0("X", year, ".", month, ".16")
      } else if (month == 2) {
        vname <- paste0("X", year, ".0", month, ".15")
      } else {
        vname <- paste0("X", year, ".0", month, ".16")
      }
      clm_data <- rasters[[var]][[vname]]
      month_list[[paste0(month)]] <- clm_data
    }
    year_list[[paste0(year)]]=month_list
  }
  bioclim_list[[paste0(var)]]=year_list
}

bioclim_list[["wet"]][["2010"]][["2"]]
```

#bioclimatic set preparation
```{r}
library(raster)

# Create empty list to store the raster stacks
stak_list <- list()
months <-1:12
years <- c(2018, 2017, 2016, 2015, 2014, 2013, 2012, 2011, 2010)

# Loop through years and months
for (year in years) {
  for (month in months) {
    # Create an empty stack to store the rasters for this month and year
    rstack <- stack()
    for (var in c("pre", "tmp", "vap", "cld", "dtr", "wet", "frs", "pet")) {
      # Get the raster for this variable, month, and year
      rlayer <- bioclim_list[[var]][[as.character(year)]][[as.character(month)]]
      #name the variables
      names(rlayer) <- var
      # Add the layer to the stack
      rstack <- addLayer(rstack, rlayer)
    }
    # Add the stack to the list of stacks
    stak_list[[paste0(sprintf("%02d", month), "_", year)]] <- rstack
  }
}
stak_list[["01_2010"]]
```



#Preparing predictors without multicollinearity
```{r}
require(usdm)
library(raster)

biopred <- list()
vifinfo <- list()


for (i in 2010:2018) {
  for (j in 1:12) {
  vifval=vifstep(stak_list[[paste0(sprintf("%02d", j), "_",i )]],th=7)
  vifinfo[[paste0(sprintf("%02d", j), "_",i )]]=vifval
  excluded_vars=names(vifval)
  biopred[[paste0(sprintf("%02d", j), "_",i)]]=exclude(stak_list[[paste0(sprintf("%02d", j), "_",i)]],vifinfo[[paste0(sprintf("%02d", j), "_",i)]])
  
}}


#to be corrected
alt_pred <- list()
for (i in years) {
  for (j in months) {
    # Get names of layers present in stak_list but absent in biopred
    alt_pred_names <- setdiff(names(stak_list[[paste0(sprintf("%02d", j), "_",i)]]), names(biopred[[paste0(sprintf("%02d", j), "_",i)]]))
    print(alt_pred_names)
    
    bpredlayer_from_list <- stak_list[[paste0(sprintf("%02d", j), "_",i)]]
    
    if (length(alt_pred_names) > 0) {
      alt_pred[[paste0(sprintf("%02d", j), "_",i)]] <- bpredlayer_from_list[[alt_pred_names]]
    } else {
      alt_pred[[paste0(sprintf("%02d", j), "_",i)]] <- raster(ncol=ncol(bpredlayer_from_list), nrow=nrow(bpredlayer_from_list))
    }
  }
}

#checking vif

```


#Extracting values
```{r}
# create an empty list to store the extracted values
extracted_values <- list()

# loop through the years and months
for (year in 2010:2018) {
  for (month in 1:12) {
    # create the key for the current year and month
    key <- sprintf("%02d_%04d", month, year)
    
    # extract values from the rasterstack for the points in the sp dataframe
    extracted_values[[key]] <- raster::extract(biopred[[key]], bcdata_list[[key]])
  }
}

extracted_values[["05_2015"]]
```


#background point generation
```{r}
library(dismo)
set.seed(3)
bgpoint_list=list()

for (i in 2010:2018) {
  for (j in 1:12) {
    df_name=sprintf("%02d_%04d", j, i)
    #print(df_name)
    env_pred=biopred[[df_name]]
    pres_point=bcdata_list[[df_name]]
    bgpoint_list[[df_name]]=randomPoints(mask=env_pred,ext=geographic_extent,n=5000,p=pres_point)
    
  }
  
}
bgpoint_list[["05_2012"]]
```

#Pseudo absence data
```{r}
absvals_list=list()

for (i in 2010:2018) {
  for (j in 1:12) {
    
    df_name=sprintf("%02d_%04d", j, i)
    #print(df_name)
    env_pred=biopred[[df_name]]
    abs_point=bgpoint_list[[df_name]]
    absvals_list[[df_name]]=raster::extract(env_pred,abs_point)
    absvals_list[[df_name]]=na.omit(absvals_list[[df_name]])
  }
  
}

absvals_list[["11_2015"]]
```


#Presence-absence-Predictor data
assigning value 1 to presence and 0 to absence
```{r}

sdmdata_list=list()
dir.create("Final SDM data v2")
for (i in 2010:2018) {
  for (j in 1:12) {
    
    df_name=sprintf("%02d_%04d", j, i)
    prespred=extracted_values[[df_name]]
    abspred=absvals_list[[df_name]]
    pb=c(rep(1, nrow(prespred)), rep(0, nrow(abspred)))
    sdmdata_set= data.frame(cbind(pb, rbind(prespred, abspred)))
    sdmdata_list[[df_name]]=na.omit(sdmdata_set)
    file_name <- paste0("Final SDM data v2/", df_name, ".csv")
    write.csv(sdmdata_list[[df_name]],file_name, col.names=T, row.names = F)
  }
  
}

sdmdata_list[["02_2012"]]

```


#Profiling
```{r}
library(sp)
library(dismo)
bc.pred_list=list()
bc.model_list=list()
bc.eval_list=list()
bc.thrs_list=list()
for (i in 2010:2018) {
  for (j in 1:12) {
     df_name=sprintf("%02d_%04d", j, i)
     bcdf=bcdata_list[[df_name]]
     group_membership=kfold(bcdf,k=5)
     train_df=bcdf[group_membership !=1, ]
     test_df=bcdf[group_membership ==1, ]
     train_df
     bc.model=bioclim(x=biopred[[df_name]],
                      p=train_df)
    bg=randomPoints(mask=biopred[[df_name]],ext=geographic_extent,n=5000,p=bcdf)
    bc.eval=evaluate(p = test_df,a=bg,
                           model = bc.model,x=biopred[[df_name]])    # Climatic variables for use by model
    bc.prediction= predict(object = bc.model, 
                                          x = biopred[[df_name]],                                          ext=geographic_extent)
  
    bc.threshold=threshold(x = bc.eval, stat = "spec_sens")
    bc.pred_list[[df_name]]=bc.prediction
    bc.model_list[[df_name]]=bc.model
    bc.eval_list[[df_name]]=bc.eval
    bc.thrs_list[[df_name]]=bc.threshold
    plot(bc.prediction>bc.threshold)
    
    }}

```

#Machine learning (Maxent)
```{r}
library(dismo)
library(rJava)
mx.pred_list=list()
mx.model_list=list()
mx.eval_list=list()
mx.thrs_list=list()
for (i in 2010:2018) {
  for (j in 1:12) {
     df_name=sprintf("%02d_%04d", j, i)
     bcdf=bcdata_list[[df_name]]
     group_membership=kfold(bcdf,k=5)
     train_df=bcdf[group_membership !=1, ]
     test_df=bcdf[group_membership ==1, ]
    bg=randomPoints(mask=biopred[[df_name]],ext=geographic_extent,n=5000,p=bcdf)
    group_bg=kfold(bg,k=5)
     train_bg=bg[group_bg !=1, ]
     test_bg=bg[group_membership==1, ]
     #mx.model=maxent(x=biopred[[df_name]], p=na.omit(train_df), a=na.omit(train_bg))
      mx.model=maxent(biopred[[df_name]], train_df)
    mx.eval=evaluate(p = na.omit(test_df),a=na.omit(test_bg),
                           model = mx.model,x=biopred[[df_name]])    # Climatic variables for use by model
    mx.prediction= predict(object = mx.model, 
                                          x = biopred[[df_name]],                                          ext=geographic_extent)
  
    mx.threshold=threshold(x = mx.eval, stat = "spec_sens")
    
    mx.pred_list[[df_name]]=mx.prediction
    mx.model_list[[df_name]]=mx.model
    mx.eval_list[[df_name]]=mx.eval
    mx.thrs_list[[df_name]]=mx.threshold
    plot(mx.prediction>mx.threshold)
    
    }}



```

#Regression
##reading the data
```{r}
library(readr)
#file_path="D:/SDM_blue_tailed_bee_eater/Final SDM data v2/"
# Set the path to the directory where the CSV files are stored
data_dir <- "Final SDM data v2"

# Get the list of CSV files in the directory
data_files <- list.files(data_dir, full.names = TRUE)

# Create an empty list to store the spatial point data frames
sdm_df_list <- list()

# Loop through the CSV files and create spatial point data frames
for (file in data_files) {
  # Extract the file name without the directory or extension
  sp_name <- gsub(".csv", "", basename(file))
  
  # Read the CSV file into a data frame
  data_df <- read.csv(file, header = TRUE, stringsAsFactors = FALSE)
  sdm_df_list[[sp_name]]=data_df
  }
  
sdm_df_list[["08_2016"]]
```
##Test and train data
```{r}
library(dismo)
set.seed(1981)
testing.group <- 1

traindata_list=list()
testdata_list=list()

for (i in 2010:2018) {
  for (j in 1:12) {
     df_name=sprintf("%02d_%04d", j, i)
     group_membership=kfold(sdm_df_list[[df_name]],k=5)
     train_df=sdm_df_list[[df_name]][group_membership != testing.group, ]
     test_df=sdm_df_list[[df_name]][group_membership == testing.group, ]
     traindata_list[[df_name]]=train_df
     testdata_list[[df_name]]=test_df
     
  }}

traindata_list[["03_2017"]]
testdata_list[["03_2017"]]
```

##modelling
```{r}

library(dismo)
gm.pred_list=list()
gm.model_list=list()
gm.eval_list=list()
gm.thrs_list=list()
for (i in 2010:2018) {
  for (j in 1:12) {
     df_name=sprintf("%02d_%04d", j, i)
     gmtrain=traindata_list[[df_name]]
     gmtest=testdata_list[[df_name]]
     prestest=subset(gmtest, pb==1)
     abstest=subset(gmtest, pb==0)
     gm.model=glm(pb~., data=gmtrain,family =gaussian(link="identity"))
     gm.eval= evaluate(prestest, abstest, gm.model) 
     gm.prediction=  predict(biopred[[df_name]], gm.model, ext=geographic_extent)
     gm.threshold=threshold(x = gm.eval, stat = "spec_sens")
    
    gm.pred_list[[df_name]]=gm.prediction
     gm.model_list[[df_name]]=gm.model
    gm.eval_list[[df_name]]=gm.eval
    gm.thrs_list[[df_name]]=gm.threshold
    plot(gm.prediction>gm.threshold)
    
    }}


```

#combining models
```{r}
combo_pred_list=list()
auc_list=list()
ensml_list=list()
thr_list=list()
for (i in 2010:2018) {
  for (j in 1:12) {
     df_name=sprintf("%02d_%04d", j, i)
     bcp=bc.pred_list[[df_name]]
     bcp[]=ifelse(bcp[]>bc.thrs_list[[df_name]],1,0)
     mxp=mx.pred_list[[df_name]]
     mxp[]=ifelse(mxp[]>mx.thrs_list[[df_name]],1,0)
     gmp=gm.pred_list[[df_name]]
     gmp[]=ifelse(gmp[]>gm.thrs_list[[df_name]],1,0)
     pred_brick=brick(bcp,mxp,gmp)
     aucval=sapply(list(bc.eval_list[[df_name]],mx.eval_list[[df_name]],gm.eval_list[[df_name]]), function(x) x@auc)
     
     wght=(aucval-(1/6))^2
     Ensmbl_m=weighted.mean(pred_brick,wght)
     thr_list[[df_name]]=c(bc.thrs_list[[df_name]],mx.thrs_list[[df_name]],gm.thrs_list[[df_name]])
     
     auc_list[[df_name]]=aucval
     combo_pred_list[[df_name]]=pred_brick
     ensml_list[[df_name]]=Ensmbl_m
  }}

plot(ensml_list[["05_2010"]])

```

#Save the files as sp doc

```{r}
library(raster)

# Create a new folder for shapefiles
dir.create("Ensemble prediction")

# Loop through the list of rasters and save each one as a shapefile
for (i in seq_along(ensml_list)) {
  # Get the raster and df_name
  ensml_raster <- ensml_list[[i]]
  df_name <- names(ensml_list)[i]
  ensml_sp=rasterToPolygons(ensml_raster)
  # Create a shapefile name based on df_name
  shp_name <- paste0("Ensemble prediction/", df_name, ".shp")
  
  # Save the raster as a shapefile
  writeOGR(ensml_sp, shp_name, layer = df_name, driver = "ESRI Shapefile")
}


```

#Reading the predicted files
```{r}
library(rgdal)

library(raster)

shp_dir <- "Ensemble prediction" # directory where .shp files are stored
shp_files <- list.files(path = shp_dir, pattern = "\\.shp$") # list of .shp files

raster_list <- list() # initialize empty list to store raster files

for (shp_file in shp_files) {
  # create file paths for all the associated files of the .shp file
  shp_path <- file.path(shp_dir, shp_file)
  dbf_path <- gsub("\\.shp$", "\\.dbf", shp_path)
  shx_path <- gsub("\\.shp$", "\\.shx", shp_path)
  prj_path <- gsub("\\.shp$", "\\.prj", shp_path)
  
  # read the .shp file as a SpatialPolygonsDataFrame
  shp_spdf <- shapefile(shp_path)
  
  # convert the SpatialPolygonsDataFrame to a raster with the same extent and resolution as a reference raster
  ref_raster <- raster(geographic_extent) # provide path to a reference raster here
  res(ref_raster)=0.005
  crs(ref_raster)=crs(wrld_simpl)
  shp_raster <- rasterize(shp_spdf, ref_raster)
  
  # store the raster in the raster_list with the same name as the .shp file
  raster_list[[gsub("\\.shp$", "", shp_file)]] <- shp_raster
}

raster_list[["08_2015"]]


```




#Plotting Ensemble models
```{r}
for (i in 2010:2018) {
  for (j in 1:12) {
    df_name=sprintf("%02d_%04d", j, i)
    plot(ensml_list[[df_name]],main=sprintf("%02d/%04d", j, i))
    plot(wrld_simpl,add=T)
    
  }
  
}

```

#Model  selection based on minimum AUC
```{r}
bestpred=list()
for (i in 2010:2018) {
  for (j in 1:12) {
    df_name=sprintf("%02d_%04d", j, i)
    index_num=which(auc_list[[df_name]]==abs(min(auc_list[[df_name]])))
    #best_m=raster(geographic_extent)
    lnm=paste0("layer.",index_num)
    best_m=combo_pred_list[[df_name]][[lnm]]
    thr_val=thr_list[[df_name]][index_num]
    best_p=raster(best_m)
    best_p[]=ifelse(best_m[]>=thr_val,best_m[],0)
    bestpred[[df_name]]=best_p
    plot(best_p,main=df_name)
    plot(wrld_simpl,add=T)
  }}

```

# Monthly migratory niche expansion per year

```{r}
library(raster)
mig_list=list()
niche1=list()
stk_list=list()

#005FFF
cl1 <- colorRampPalette(c( "yellow1","gold4" ))(6)
cl2 <- colorRampPalette(c( "skyblue","darkblue" ))(6)

cl=colorRampPalette(c("white",cl1,cl2))
#par(mfrow=c(3,3))
for (i in 2010:2018) {
  for (j in 1:12) {
    df_name=sprintf("%02d_%04d", j, i)
    n1=ensml_list[[df_name]]
    niche1[[paste0(i)]][[paste0(j)]]=n1 
  }
  raster_stack=stack(niche1[[paste0(i)]])
  stk_list[[paste0(i)]]=raster_stack
  raster_sum=calc(raster_stack, sum)/12
  mig_list[[paste0(i)]]=raster_sum
  plot(raster_sum,col=cl(13),main=paste0(i))
  plot(wrld_simpl,add=T)
}
#stk_list[["2010"]]


#library(ggplot2)

# Define the colors
#cl1 <- colorRampPalette(c("yellow1", "gold4"))(6)
#cl2 <- colorRampPalette(c("skyblue", "darkblue"))(6)
#cl <- colorRampPalette(c("white", cl1, cl2))(13)

# Create a data frame for the color strip
#df <- data.frame(x = 0:12, y = 1, fill = cl)

# Create the color strip plot
#ggplot(df, aes(x = x, y = y, fill = fill)) +
#  geom_tile() +
#  scale_fill_identity(seq(0,1, length.out=13)) +
#  theme_void() +
#  theme(legend.position = "none")


```

#Inter annual Variance

```{r}
library(raster)
allmig = brick(mig_list)
var_list = list()
zmat=matrix(NA, 9, 9)
pmat=matrix(NA,9,9)
matrix_var = matrix(NA, 9, 9)
for (i in 2010:2018) {
  for (j in 2010:2018) {
    n1 = paste0("X", i)
    n2 = paste0("X", j)
    rt1 = allmig[[n1]]
    rt2 = allmig[[n2]]
    dr1 = dr2 = raster(rt1)
    dr1[] = ifelse(rt1[] != rt2[], 1, 0)
    
    dr2[] = ifelse(rt1[] == rt2[], 1, 0)
    #plot(dr1)#;plot(dr2)
   # dr2[] = ifelse(rt1[] == rt2[], rt1[], 0)
    #dr2[] = ifelse(dr2[] > 0, 1, dr2[])
    #dr2[]=ifelse(is.na(dr2[])==T,0,dr2[] )
    
    d1 = sum(dr1[] == 1, na.rm = TRUE)
    d2 = sum(dr2[] == 1, na.rm = TRUE)
  
    ratioval = d1/d2
    
    vals1 <- getValues(rt1)
    vals2 <- getValues(rt2)
    vals1=na.omit(vals1)
    vals2=na.omit(vals2)

    l1 <- length(vals1)
    l2 <- length(vals2)
    s1 <- sum(vals1)
    s2 <- sum(vals2)
    f1 <- l1 - s1
    f2 <- l2 - s2

   # Calculate proportions and pooled proportion
  p1= s1/l1
  p2= s2/l2
  p_pool <- (s1 + s2)/(l1 + l2)

   # Calculate standard error of the difference between proportions
   se_diff <- sqrt(p_pool*(1-p_pool)*(1/l1 + 1/l2))

   # Calculate z-score and p-value
   z_score <- (p1 - p2) / se_diff
   p_value <- 2 * pnorm(-abs(z_score))
   zmat[i-2009,j-2009]=z_score
   pmat[i-2009,j-2009]=p_value

    
    # Reclassify the rasters by collapsing the categories
    #rt1_collapse = reclassify(rt1, cbind(c(0, 1), 1))
    #rt2_collapse = reclassify(rt2, cbind(c(0, 1), 1))
    
    # Convert the rasters to data frames
    #df1 = as.data.frame(rt1_collapse, xy = TRUE)
    #df2 = as.data.frame(rt2_collapse, xy = TRUE)
    
    # Merge the data frames by their xy coordinates
    #df = merge(df1, df2, by = c("x", "y"))
    
    # Rename the columns
    #colnames(df) = c("x", "y", "rt1", "rt2")
    
    # Perform Fisher's exact test
   # cont_table = table(df$rt1, df$rt2)
   # dim(cont_table)
    # Perform Fisher's exact test with 10000 Monte Carlo simulations
 #  fisher_test <- fisher.test(cont_table, simulate.p.value = T)
 
    
    matrix_var[i - 2009, j - 2009] = ratioval
    #var_list[[paste0(i)]][[paste0(j)]] = chi2test
  }
}



row.names(matrix_var)=as.character(2010:2018)
colnames(matrix_var)=as.character(2010:2018)

row.names(zmat)=as.character(2010:2018)
colnames(zmat)=as.character(2010:2018)

row.names(pmat)=as.character(2010:2018)
colnames(pmat)=as.character(2010:2018)

matrix_var
######
# Load ggplot2 library
library(ggplot2)

# Visualize the matrix using ggplot
ggplot(data = reshape2::melt(matrix_var)) +
  geom_tile(aes(x = Var2, y = Var1, fill = value)) +
  scale_fill_gradient(low = "gray96", high = "#008A99") +
  labs(x = "", y = "", fill = "") +
  theme_minimal() +
  theme(panel.grid = element_blank())
ggplot(data = reshape2::melt(zmat)) +
  geom_tile(aes(x = Var2, y = Var1, fill = value)) +
  scale_fill_gradient(low = "gray96", high = "#008A99") +
  labs(x = "", y = "", fill = "") +
  theme_minimal() +
  theme(panel.grid = element_blank())

matrix_var;
zmat;pmat

write.csv(zmat,"Zscore.csv",row.names = T)
write.csv(pmat,"pval.csv",row.names = T)

```

#Origin and destinations over time
```{r}
cl1 <- colorRampPalette(c( "yellow1","gold4" ))(10)
cl2 <- colorRampPalette(c( "skyblue","darkblue" ))(10)
cl3 <- colorRampPalette(c( "lightpink","darkred" ))(10)
cl4 <- colorRampPalette(c( "lightgreen","darkgreen" ))(10)
origin_list=list()
destination_list=list()
for (i in 2010:2018) {
  for (j in 2:12) {
    nm1=sprintf("%02d_%04d", j, i)
    nm2=sprintf("%02d_%04d", j-1, i)
    d1=ensml_list[[nm1]]-ensml_list[[nm2]]
    d2=d3=raster(d1)
    d2[]=ifelse(d1[]<0, d1[], 0)
    d3[]=ifelse(d1[]>0, d1[],0)
    origin_list[[paste0(nm1,"-",nm2)]]=d2
    destination_list[[paste0(nm1,"-",nm2)]]=d3
    par(mfrow=c(1,2))
    plot(d2,col=c(cl2(6),"white"), main=paste0("Origin of", j-1, "/", i));plot(wrld_simpl,add=T)
    plot(d3,col=c("white",cl1(6)), main=paste0("Destination of", j-1, "/", i));plot(wrld_simpl,add=T)
  }}

#origin_list[["02_2014-01_2014"]]
#destination_list[["02_2014-01_2014"]]
```
# seasonal niche
```{r}
origin_list=list()
destination_list=list()
immigration_list=list()
emigration_list=list()
cl1 <- c("white",colorRampPalette(c( "yellow1","gold4" ))(12))
cl2 <- c("white",colorRampPalette(c( "skyblue","darkblue" ))(12))
cl3 <- c("white",colorRampPalette(c( "lightpink","darkred" ))(12))
cl4 <- c("white",colorRampPalette(c( "lightgreen","darkgreen" ))(12))
nc1=list()
for (i in 2010:2018) {
  for (j in c(1,12)) {
    nm1=sprintf("%02d_%04d", j, i)
    nc1=stack(ensml_list[[nm1]])
  }
  org_v=calc(nc1, mean)
  origin_list[[paste0(i)]]=org_v

  for (k in c(5:7)) {
    nm2=sprintf("%02d_%04d", k, i)
    nc2=stack(ensml_list[[nm2]])
    
  }
  dst_v=calc(nc2,mean)
  destination_list[[paste0(i)]]=dst_v
  
  for (l in c(3:4)) {
    nm3=sprintf("%02d_%04d", l, i)
    nc3=stack(ensml_list[[nm3]])
    
  }
  imm_v=calc(nc3,mean)
  immigration_list[[paste0(i)]]=imm_v
  
  for (m in c(9:10)) {
    nm4=sprintf("%02d_%04d", m, i)
    nc4=stack(ensml_list[[nm3]])
  }
  emm_v=calc(nc4,mean)
  emigration_list[[paste0(i)]]=emm_v
    par(mfrow=c(2,2))
    plot(org_v, main=paste0("Origins of ", i), col=cl3)
    plot(wrld_simpl,add=T)
    plot(dst_v, main=paste0("Destinations of ", i), col=cl4)
    plot(wrld_simpl,add=T)
    plot(imm_v, main=paste0("Immigration flyways of ", i), col=cl2)
    plot(wrld_simpl,add=T)
    plot(emm_v, main=paste0("Emigration flyways of ", i), col=cl1)
    plot(wrld_simpl,add=T)
}

```








##########
#Niche shift for each month
```{r}
ns_2010_1_2=p_2010_2+p_2010_2 - p_2010_1 
ns_2010_2_3=p_2010_3+p_2010_3 - p_2010_2
ns_2010_3_4=p_2010_4+p_2010_4 - p_2010_3
ns_2010_4_5=p_2010_5+p_2010_5 - p_2010_4
ns_2010_5_6=p_2010_6+p_2010_6 - p_2010_5
ns_2010_6_7=p_2010_7+p_2010_7 - p_2010_6
ns_2010_7_8=p_2010_8+p_2010_8 - p_2010_7
ns_2010_8_9=p_2010_9+p_2010_9 - p_2010_8
ns_2010_9_10=p_2010_10+p_2010_10 - p_2010_9
ns_2010_10_11=p_2010_11+p_2010_11 - p_2010_10
ns_2010_11_12=p_2010_12+p_2010_12 - p_2010_11
ns_2010_12_1=p_2011_1+p_2011_1 - p_2010_12

ns_2011_1_2=p_2011_2+p_2011_2 - p_2011_1 
ns_2011_2_3=p_2011_3+p_2011_3 - p_2011_2
ns_2011_3_4=p_2011_4+p_2011_4 - p_2011_3
ns_2011_4_5=p_2011_5+p_2011_5 - p_2011_4
ns_2011_5_6=p_2011_6+p_2011_6 - p_2011_5
ns_2011_6_7=p_2011_7+p_2011_7 - p_2011_6
ns_2011_7_8=p_2011_8+p_2011_8 - p_2011_7
ns_2011_8_9=p_2011_9+p_2011_9 - p_2011_8
ns_2011_9_10=p_2011_10+p_2011_10 - p_2011_9
ns_2011_10_11=p_2011_11+p_2011_11 - p_2011_10
ns_2011_11_12=p_2011_12+p_2011_12 - p_2011_11
ns_2011_12_1=p_2012_1+p_2012_1 - p_2011_12

ns_2012_1_2=p_2012_2+p_2012_2 - p_2012_1 
ns_2012_2_3=p_2012_3+p_2012_3 - p_2012_2
ns_2012_3_4=p_2012_4+p_2012_4 - p_2012_3
ns_2012_4_5=p_2012_5+p_2012_5 - p_2012_4
ns_2012_5_6=p_2012_6+p_2012_6 - p_2012_5
ns_2012_6_7=p_2012_7+p_2012_7 - p_2012_6
ns_2012_7_8=p_2012_8+p_2012_8 - p_2012_7
ns_2012_8_9=p_2012_9+p_2012_9 - p_2012_8
ns_2012_9_10=p_2012_10+p_2012_10 - p_2012_9
ns_2012_10_11=p_2012_11+p_2012_11 - p_2012_10
ns_2012_11_12=p_2012_12+p_2012_12 - p_2012_11
ns_2012_12_1=p_2013_1+p_2013_1 - p_2012_12

ns_2013_1_2=p_2013_2+p_2013_2 - p_2013_1 
ns_2013_2_3=p_2013_3+p_2013_3 - p_2013_2
ns_2013_3_4=p_2013_4+p_2013_4 - p_2013_3
ns_2013_4_5=p_2013_5+p_2013_5 - p_2013_4
ns_2013_5_6=p_2013_6+p_2013_6 - p_2013_5
ns_2013_6_7=p_2013_7+p_2013_7 - p_2013_6
ns_2013_7_8=p_2013_8+p_2013_8 - p_2013_7
ns_2013_8_9=p_2013_9+p_2013_9 - p_2013_8
ns_2013_9_10=p_2013_10+p_2013_10 - p_2013_9
ns_2013_10_11=p_2013_11+p_2013_11 - p_2013_10
ns_2013_11_12=p_2013_12+p_2013_12 - p_2013_11
ns_2013_12_1=p_2014_1+p_2014_1 - p_2013_12

ns_2014_1_2=p_2014_2+p_2014_2 - p_2014_1 
ns_2014_2_3=p_2014_3+p_2014_3 - p_2014_2
ns_2014_3_4=p_2014_4+p_2014_4 - p_2014_3
ns_2014_4_5=p_2014_5+p_2014_5 - p_2014_4
ns_2014_5_6=p_2014_6+p_2014_6 - p_2014_5
ns_2014_6_7=p_2014_7+p_2014_7 - p_2014_6
ns_2014_7_8=p_2014_8+p_2014_8 - p_2014_7
ns_2014_8_9=p_2014_9+p_2014_9 - p_2014_8
ns_2014_9_10=p_2014_10+p_2014_10 - p_2014_9
ns_2014_10_11=p_2014_11+p_2014_11 - p_2014_10
ns_2014_11_12=p_2014_12+p_2014_12 - p_2014_11
ns_2014_12_1=p_2015_1+p_2015_1 - p_2014_12

ns_2015_1_2=p_2015_2+p_2015_2 - p_2015_1 
ns_2015_2_3=p_2015_3+p_2015_3 - p_2015_2
ns_2015_3_4=p_2015_4+p_2015_4 - p_2015_3
ns_2015_4_5=p_2015_5+p_2015_5 - p_2015_4
ns_2015_5_6=p_2015_6+p_2015_6 - p_2015_5
ns_2015_6_7=p_2015_7+p_2015_7 - p_2015_6
ns_2015_7_8=p_2015_8+p_2015_8 - p_2015_7
ns_2015_8_9=p_2015_9+p_2015_9 - p_2015_8
ns_2015_9_10=p_2015_10+p_2015_10 - p_2015_9
ns_2015_10_11=p_2015_11+p_2015_11 - p_2015_10
ns_2015_11_12=p_2015_12+p_2015_12 - p_2015_11
ns_2015_12_1=p_2016_1+p_2016_1 - p_2015_12

ns_2016_1_2=p_2016_2+p_2016_2 - p_2016_1 
ns_2016_2_3=p_2016_3+p_2016_3 - p_2016_2
ns_2016_3_4=p_2016_4+p_2016_4 - p_2016_3
ns_2016_4_5=p_2016_5+p_2016_5 - p_2016_4
ns_2016_5_6=p_2016_6+p_2016_6 - p_2016_5
ns_2016_6_7=p_2016_7+p_2016_7 - p_2016_6
ns_2016_7_8=p_2016_8+p_2016_8 - p_2016_7
ns_2016_8_9=p_2016_9+p_2016_9 - p_2016_8
ns_2016_9_10=p_2016_10+p_2016_10 - p_2016_9
ns_2016_10_11=p_2016_11+p_2016_11 - p_2016_10
ns_2016_11_12=p_2016_12+p_2016_12 - p_2016_11
ns_2016_12_1=p_2017_1+p_2017_1 - p_2016_12

ns_2017_1_2=p_2017_2+p_2017_2 - p_2017_1 
ns_2017_2_3=p_2017_3+p_2017_3 - p_2017_2
ns_2017_3_4=p_2017_4+p_2017_4 - p_2017_3
ns_2017_4_5=p_2017_5+p_2017_5 - p_2017_4
ns_2017_5_6=p_2017_6+p_2017_6 - p_2017_5
ns_2017_6_7=p_2017_7+p_2017_7 - p_2017_6
ns_2017_7_8=p_2017_8+p_2017_8 - p_2017_7
ns_2017_8_9=p_2017_9+p_2017_9 - p_2017_8
ns_2017_9_10=p_2017_10+p_2017_10 - p_2017_9
ns_2017_10_11=p_2017_11+p_2017_11 - p_2017_10
ns_2017_11_12=p_2017_12+p_2017_12 - p_2017_11
ns_2017_12_1=p_2018_1+p_2018_1 - p_2017_12

ns_2018_1_2=p_2018_2+p_2018_2 - p_2018_1 
ns_2018_2_3=p_2018_3+p_2018_3 - p_2018_2
ns_2018_3_4=p_2018_4+p_2018_4 - p_2018_3
ns_2018_4_5=p_2018_5+p_2018_5 - p_2018_4
ns_2018_5_6=p_2018_6+p_2018_6 - p_2018_5
ns_2018_6_7=p_2018_7+p_2018_7 - p_2018_6
ns_2018_7_8=p_2018_8+p_2018_8 - p_2018_7
ns_2018_8_9=p_2018_9+p_2018_9 - p_2018_8
ns_2018_9_10=p_2018_10+p_2018_10 - p_2018_9
ns_2018_10_11=p_2018_11+p_2018_11 - p_2018_10
ns_2018_11_12=p_2018_12+p_2018_12 - p_2018_11


```

#Checking plots for niche shift year and month wise
```{r}
cl=colorRampPalette(c("#FFD4CC","#F4FAF2","#FFE5E0","#C7E8BE"))
plot(ns_2010_1_2,col=cl(4),main="Origins and Destinations in February 2010")
plot(wrld_simpl,add=T)

plot(ns_2010_2_3,col=cl(4),main="Origins and Destinations in March 2010")
plot(wrld_simpl,add=T)

plot(ns_2010_3_4,col=cl(4),main="Origins and Destinations in April 2010")
plot(wrld_simpl,add=T)

plot(ns_2010_4_5,col=cl(4),main="Origins and Destinations in May 2010")
plot(wrld_simpl,add=T)

plot(ns_2010_5_6,col=cl(4),main="Origins and Destinations in June 2010")
plot(wrld_simpl,add=T)

plot(ns_2010_6_7,col=cl(4),main="Origins and Destinations in July 2010")
plot(wrld_simpl,add=T)

plot(ns_2010_7_8,col=cl(4),main="Origins and Destinations in August 2010")
plot(wrld_simpl,add=T)

plot(ns_2010_8_9,col=cl(4),main="Origins and Destinations in September 2010")
plot(wrld_simpl,add=T)

plot(ns_2010_9_10,col=cl(4),main="Origins and Destinations in October 2010")
plot(wrld_simpl,add=T)

plot(ns_2010_10_11,col=cl(4),main="Origins and Destinations in November 2010")
plot(wrld_simpl,add=T)

plot(ns_2010_11_12,col=cl(4),main="Origins and Destinations in December 2010")
plot(wrld_simpl,add=T)

plot(ns_2010_12_1,col=cl(4),main="Origins and Destinations in January 2011")
plot(wrld_simpl,add=T)


plot(ns_2011_1_2,col=cl(4),main="Origins and Destinations in February 2011")
plot(wrld_simpl,add=T)

plot(ns_2011_2_3,col=cl(4),main="Origins and Destinations in March 2011")
plot(wrld_simpl,add=T)

plot(ns_2011_3_4,col=cl(4),main="Origins and Destinations in April 2011")
plot(wrld_simpl,add=T)

plot(ns_2011_4_5,col=cl(4),main="Origins and Destinations in May 2011")
plot(wrld_simpl,add=T)

plot(ns_2011_5_6,col=cl(4),main="Origins and Destinations in June 2011")
plot(wrld_simpl,add=T)

plot(ns_2011_6_7,col=cl(4),main="Origins and Destinations in July 2011")
plot(wrld_simpl,add=T)

plot(ns_2011_7_8,col=cl(4),main="Origins and Destinations in August 2011")
plot(wrld_simpl,add=T)

plot(ns_2011_8_9,col=cl(4),main="Origins and Destinations in September 2011")
plot(wrld_simpl,add=T)

plot(ns_2011_9_10,col=cl(4),main="Origins and Destinations in October 2011")
plot(wrld_simpl,add=T)

plot(ns_2011_10_11,col=cl(4),main="Origins and Destinations in November 2011")
plot(wrld_simpl,add=T)

plot(ns_2011_11_12,col=cl(4),main="Origins and Destinations in December 2011")
plot(wrld_simpl,add=T)

plot(ns_2011_12_1,col=cl(4),main="Origins and Destinations in January 2012")
plot(wrld_simpl,add=T)


plot(ns_2012_1_2,col=cl(4),main="Origins and Destinations in February 2012")
plot(wrld_simpl,add=T)

plot(ns_2012_2_3,col=cl(4),main="Origins and Destinations in March 2012")
plot(wrld_simpl,add=T)

plot(ns_2012_3_4,col=cl(4),main="Origins and Destinations in April 2012")
plot(wrld_simpl,add=T)

plot(ns_2012_4_5,col=cl(4),main="Origins and Destinations in May 2012")
plot(wrld_simpl,add=T)

plot(ns_2012_5_6,col=cl(4),main="Origins and Destinations in June 2012")
plot(wrld_simpl,add=T)

plot(ns_2012_6_7,col=cl(4),main="Origins and Destinations in July 2012")
plot(wrld_simpl,add=T)

plot(ns_2012_7_8,col=cl(4),main="Origins and Destinations in August 2012")
plot(wrld_simpl,add=T)

plot(ns_2012_8_9,col=cl(4),main="Origins and Destinations in September 2012")
plot(wrld_simpl,add=T)

plot(ns_2012_9_10,col=cl(4),main="Origins and Destinations in October 2012")
plot(wrld_simpl,add=T)

plot(ns_2012_10_11,col=cl(4),main="Origins and Destinations in November 2012")
plot(wrld_simpl,add=T)

plot(ns_2012_11_12,col=cl(4),main="Origins and Destinations in December 2012")
plot(wrld_simpl,add=T)

plot(ns_2012_12_1,col=cl(4),main="Origins and Destinations in January 2013")
plot(wrld_simpl,add=T)


plot(ns_2013_1_2,col=cl(4),main="Origins and Destinations in February 2013")
plot(wrld_simpl,add=T)

plot(ns_2013_2_3,col=cl(4),main="Origins and Destinations in March 2013")
plot(wrld_simpl,add=T)

plot(ns_2013_3_4,col=cl(4),main="Origins and Destinations in April 2013")
plot(wrld_simpl,add=T)

plot(ns_2013_4_5,col=cl(4),main="Origins and Destinations in May 2013")
plot(wrld_simpl,add=T)

plot(ns_2013_5_6,col=cl(4),main="Origins and Destinations in June 2013")
plot(wrld_simpl,add=T)

plot(ns_2013_6_7,col=cl(4),main="Origins and Destinations in July 2013")
plot(wrld_simpl,add=T)

plot(ns_2013_7_8,col=cl(4),main="Origins and Destinations in August 2013")
plot(wrld_simpl,add=T)

plot(ns_2013_8_9,col=cl(4),main="Origins and Destinations in September 2013")
plot(wrld_simpl,add=T)

plot(ns_2013_9_10,col=cl(4),main="Origins and Destinations in October 2013")
plot(wrld_simpl,add=T)

plot(ns_2013_10_11,col=cl(4),main="Origins and Destinations in November 2013")
plot(wrld_simpl,add=T)

plot(ns_2013_11_12,col=cl(4),main="Origins and Destinations in December 2013")
plot(wrld_simpl,add=T)


plot(ns_2013_12_1,col=cl(4),main="Origins and Destinations in January 2014")
plot(wrld_simpl,add=T)

plot(ns_2014_1_2,col=cl(4),main="Origins and Destinations in February 2014")
plot(wrld_simpl,add=T)

plot(ns_2014_2_3,col=cl(4),main="Origins and Destinations in March 2014")
plot(wrld_simpl,add=T)

plot(ns_2014_3_4,col=cl(4),main="Origins and Destinations in April 2014")
plot(wrld_simpl,add=T)

plot(ns_2014_4_5,col=cl(4),main="Origins and Destinations in May 2014")
plot(wrld_simpl,add=T)

plot(ns_2014_5_6,col=cl(4),main="Origins and Destinations in June 2014")
plot(wrld_simpl,add=T)

plot(ns_2014_6_7,col=cl(4),main="Origins and Destinations in July 2014")
plot(wrld_simpl,add=T)

plot(ns_2014_7_8,col=cl(4),main="Origins and Destinations in August 2014")
plot(wrld_simpl,add=T)

plot(ns_2014_8_9,col=cl(4),main="Origins and Destinations in September 2014")
plot(wrld_simpl,add=T)

plot(ns_2014_9_10,col=cl(4),main="Origins and Destinations in October 2014")
plot(wrld_simpl,add=T)

plot(ns_2014_10_11,col=cl(4),main="Origins and Destinations in November 2014")
plot(wrld_simpl,add=T)

plot(ns_2014_11_12,col=cl(4),main="Origins and Destinations in December 2014")
plot(wrld_simpl,add=T)

plot(ns_2014_12_1,col=cl(4),main="Origins and Destinations in January 2015")
plot(wrld_simpl,add=T)


plot(ns_2015_1_2,col=cl(4),main="Origins and Destinations in February 2015")
plot(wrld_simpl,add=T)

plot(ns_2015_2_3,col=cl(4),main="Origins and Destinations in March 2015")
plot(wrld_simpl,add=T)

plot(ns_2015_3_4,col=cl(4),main="Origins and Destinations in April 2015")
plot(wrld_simpl,add=T)

plot(ns_2015_4_5,col=cl(4),main="Origins and Destinations in May 2015")
plot(wrld_simpl,add=T)

plot(ns_2015_5_6,col=cl(4),main="Origins and Destinations in June 2015")
plot(wrld_simpl,add=T)

plot(ns_2015_6_7,col=cl(4),main="Origins and Destinations in July 2015")
plot(wrld_simpl,add=T)

plot(ns_2015_7_8,col=cl(4),main="Origins and Destinations in August 2015")
plot(wrld_simpl,add=T)

plot(ns_2015_8_9,col=cl(4),main="Origins and Destinations in September 2015")
plot(wrld_simpl,add=T)

plot(ns_2015_9_10,col=cl(4),main="Origins and Destinations in October 2015")
plot(wrld_simpl,add=T)

plot(ns_2015_10_11,col=cl(4),main="Origins and Destinations in November 2015")
plot(wrld_simpl,add=T)

plot(ns_2015_11_12,col=cl(4),main="Origins and Destinations in December 2015")
plot(wrld_simpl,add=T)


plot(ns_2015_12_1,col=cl(4),main="Origins and Destinations in January 2016")
plot(wrld_simpl,add=T)


plot(ns_2016_1_2,col=cl(4),main="Origins and Destinations in February 2016")
plot(wrld_simpl,add=T)

plot(ns_2016_2_3,col=cl(4),main="Origins and Destinations in March 2016")
plot(wrld_simpl,add=T)

plot(ns_2016_3_4,col=cl(4),main="Origins and Destinations in April 2016")
plot(wrld_simpl,add=T)

plot(ns_2016_4_5,col=cl(4),main="Origins and Destinations in May 2016")
plot(wrld_simpl,add=T)

plot(ns_2016_5_6,col=cl(4),main="Origins and Destinations in June 2016")
plot(wrld_simpl,add=T)

plot(ns_2016_6_7,col=cl(4),main="Origins and Destinations in July 2016")
plot(wrld_simpl,add=T)

plot(ns_2016_7_8,col=cl(4),main="Origins and Destinations in August 2016")
plot(wrld_simpl,add=T)

plot(ns_2016_8_9,col=cl(4),main="Origins and Destinations in September 2016")
plot(wrld_simpl,add=T)

plot(ns_2016_9_10,col=cl(4),main="Origins and Destinations in October 2016")
plot(wrld_simpl,add=T)

plot(ns_2016_10_11,col=cl(4),main="Origins and Destinations in November 2016")
plot(wrld_simpl,add=T)

plot(ns_2016_11_12,col=cl(4),main="Origins and Destinations in December 2016")
plot(wrld_simpl,add=T)


plot(ns_2016_12_1,col=cl(4),main="Origins and Destinations in January 2017")
plot(wrld_simpl,add=T)


plot(ns_2017_1_2,col=cl(4),main="Origins and Destinations in February 2017")
plot(wrld_simpl,add=T)

plot(ns_2017_2_3,col=cl(4),main="Origins and Destinations in March 2017")
plot(wrld_simpl,add=T)

plot(ns_2017_3_4,col=cl(4),main="Origins and Destinations in April 2017")
plot(wrld_simpl,add=T)

plot(ns_2017_4_5,col=cl(4),main="Origins and Destinations in May 2017")
plot(wrld_simpl,add=T)

plot(ns_2017_5_6,col=cl(4),main="Origins and Destinations in June 2017")
plot(wrld_simpl,add=T)

plot(ns_2017_6_7,col=cl(4),main="Origins and Destinations in July 2017")
plot(wrld_simpl,add=T)

plot(ns_2017_7_8,col=cl(4),main="Origins and Destinations in August 2017")
plot(wrld_simpl,add=T)

plot(ns_2017_8_9,col=cl(4),main="Origins and Destinations in September 2017")
plot(wrld_simpl,add=T)

plot(ns_2017_9_10,col=cl(4),main="Origins and Destinations in October 2017")
plot(wrld_simpl,add=T)

plot(ns_2017_10_11,col=cl(4),main="Origins and Destinations in November 2017")
plot(wrld_simpl,add=T)

plot(ns_2017_11_12,col=cl(4),main="Origins and Destinations in December 2017")
plot(wrld_simpl,add=T)

plot(ns_2017_12_1,col=cl(4),main="Origins and Destinations in January 2018")
plot(wrld_simpl,add=T)


plot(ns_2018_1_2,col=cl(4),main="Origins and Destinations in February 2018")
plot(wrld_simpl,add=T)

plot(ns_2018_2_3,col=cl(4),main="Origins and Destinations in March 2018")
plot(wrld_simpl,add=T)

plot(ns_2018_3_4,col=cl(4),main="Origins and Destinations in April 2018")
plot(wrld_simpl,add=T)

plot(ns_2018_4_5,col=cl(4),main="Origins and Destinations in May 2018")
plot(wrld_simpl,add=T)

plot(ns_2018_5_6,col=cl(4),main="Origins and Destinations in June 2018")
plot(wrld_simpl,add=T)

plot(ns_2018_6_7,col=cl(4),main="Origins and Destinations in July 2018")
plot(wrld_simpl,add=T)

plot(ns_2018_7_8,col=cl(4),main="Origins and Destinations in August 2018")
plot(wrld_simpl,add=T)

plot(ns_2018_8_9,col=cl(4),main="Origins and Destinations in September 2018")
plot(wrld_simpl,add=T)

plot(ns_2018_9_10,col=cl(4),main="Origins and Destinations in October 2018")
plot(wrld_simpl,add=T)

plot(ns_2018_10_11,col=cl(4),main="Origins and Destinations in November 2018")
plot(wrld_simpl,add=T)

plot(ns_2018_11_12,col=cl(4),main="Origins and Destinations in December 2018")
plot(wrld_simpl,add=T)


```
#Niche shift for months year wise 

```{r}
ns_1_2010_2011=p_2011_1+p_2011_1-p_2010_1
ns_2_2010_2011=p_2011_2+p_2011_2-p_2010_2
ns_3_2010_2011=p_2011_3+p_2011_3-p_2010_3
ns_4_2010_2011=p_2011_4+p_2011_4-p_2010_4
ns_5_2010_2011=p_2011_5+p_2011_5-p_2010_5
ns_6_2010_2011=p_2011_6+p_2011_6-p_2010_6
ns_7_2010_2011=p_2011_7+p_2011_7-p_2010_7
ns_8_2010_2011=p_2011_8+p_2011_8-p_2010_8
ns_9_2010_2011=p_2011_9+p_2011_9-p_2010_9
ns_10_2010_2011=p_2011_10+p_2011_10-p_2010_10
ns_11_2010_2011=p_2011_11+p_2011_11-p_2010_11
ns_12_2010_2011=p_2011_12+p_2011_12-p_2010_12

ns_1_2011_2012=p_2012_1+p_2012_1-p_2011_1
ns_2_2011_2012=p_2012_2+p_2012_2-p_2011_2
ns_3_2011_2012=p_2012_3+p_2012_3-p_2011_3
ns_4_2011_2012=p_2012_4+p_2012_4-p_2011_4
ns_5_2011_2012=p_2012_5+p_2012_5-p_2011_5
ns_6_2011_2012=p_2012_6+p_2012_6-p_2011_6
ns_7_2011_2012=p_2012_7+p_2012_7-p_2011_7
ns_8_2011_2012=p_2012_8+p_2012_8-p_2011_8
ns_9_2011_2012=p_2012_9+p_2012_9-p_2011_9
ns_10_2011_2012=p_2012_10+p_2012_10-p_2011_10
ns_11_2011_2012=p_2012_11+p_2012_11-p_2011_11
ns_12_2011_2012=p_2012_12+p_2012_12-p_2011_12

ns_1_2012_2013=p_2013_1+p_2013_1-p_2012_1
ns_2_2012_2013=p_2013_2+p_2013_2-p_2012_2
ns_3_2012_2013=p_2013_3+p_2013_3-p_2012_3
ns_4_2012_2013=p_2013_4+p_2013_4-p_2012_4
ns_5_2012_2013=p_2013_5+p_2013_5-p_2012_5
ns_6_2012_2013=p_2013_6+p_2013_6-p_2012_6
ns_7_2012_2013=p_2013_7+p_2013_7-p_2012_7
ns_8_2012_2013=p_2013_8+p_2013_8-p_2012_8
ns_9_2012_2013=p_2013_9+p_2013_9-p_2012_9
ns_10_2012_2013=p_2013_10+p_2013_10-p_2012_10
ns_11_2012_2013=p_2013_11+p_2013_11-p_2012_11
ns_12_2012_2013=p_2013_12+p_2013_12-p_2012_12

ns_1_2013_2014=p_2014_1+p_2014_1-p_2013_1
ns_2_2013_2014=p_2014_2+p_2014_2-p_2013_2
ns_3_2013_2014=p_2014_3+p_2014_3-p_2013_3
ns_4_2013_2014=p_2014_4+p_2014_4-p_2013_4
ns_5_2013_2014=p_2014_5+p_2014_5-p_2013_5
ns_6_2013_2014=p_2014_6+p_2014_6-p_2013_6
ns_7_2013_2014=p_2014_7+p_2014_7-p_2013_7
ns_8_2013_2014=p_2014_8+p_2014_8-p_2013_8
ns_9_2013_2014=p_2014_9+p_2014_9-p_2013_9
ns_10_2013_2014=p_2014_10+p_2014_10-p_2013_10
ns_11_2013_2014=p_2014_11+p_2014_11-p_2013_11
ns_12_2013_2014=p_2014_12+p_2014_12-p_2013_12

ns_1_2014_2015=p_2015_1+p_2015_1-p_2014_1
ns_2_2014_2015=p_2015_2+p_2015_2-p_2014_2
ns_3_2014_2015=p_2015_3+p_2015_3-p_2014_3
ns_4_2014_2015=p_2015_4+p_2015_4-p_2014_4
ns_5_2014_2015=p_2015_5+p_2015_5-p_2014_5
ns_6_2014_2015=p_2015_6+p_2015_6-p_2014_6
ns_7_2014_2015=p_2015_7+p_2015_7-p_2014_7
ns_8_2014_2015=p_2015_8+p_2015_8-p_2014_8
ns_9_2014_2015=p_2015_9+p_2015_9-p_2014_9
ns_10_2014_2015=p_2015_10+p_2015_10-p_2014_10
ns_11_2014_2015=p_2015_11+p_2015_11-p_2014_11
ns_12_2014_2015=p_2015_12+p_2015_12-p_2014_12

ns_1_2015_2016=p_2016_1+p_2016_1-p_2015_1
ns_2_2015_2016=p_2016_2+p_2016_2-p_2015_2
ns_3_2015_2016=p_2016_3+p_2016_3-p_2015_3
ns_4_2015_2016=p_2016_4+p_2016_4-p_2015_4
ns_5_2015_2016=p_2016_5+p_2016_5-p_2015_5
ns_6_2015_2016=p_2016_6+p_2016_6-p_2015_6
ns_7_2015_2016=p_2016_7+p_2016_7-p_2015_7
ns_8_2015_2016=p_2016_8+p_2016_8-p_2015_8
ns_9_2015_2016=p_2016_9+p_2016_9-p_2015_9
ns_10_2015_2016=p_2016_10+p_2016_10-p_2015_10
ns_11_2015_2016=p_2016_11+p_2016_11-p_2015_11
ns_12_2015_2016=p_2016_12+p_2016_12-p_2015_12

ns_1_2016_2017=p_2017_1+p_2017_1-p_2016_1
ns_2_2016_2017=p_2017_2+p_2017_2-p_2016_2
ns_3_2016_2017=p_2017_3+p_2017_3-p_2016_3
ns_4_2016_2017=p_2017_4+p_2017_4-p_2016_4
ns_5_2016_2017=p_2017_5+p_2017_5-p_2016_5
ns_6_2016_2017=p_2017_6+p_2017_6-p_2016_6
ns_7_2016_2017=p_2017_7+p_2017_7-p_2016_7
ns_8_2016_2017=p_2017_8+p_2017_8-p_2016_8
ns_9_2016_2017=p_2017_9+p_2017_9-p_2016_9
ns_10_2016_2017=p_2017_10+p_2017_10-p_2016_10
ns_11_2016_2017=p_2017_11+p_2017_11-p_2016_11
ns_12_2016_2017=p_2017_12+p_2017_12-p_2016_12

ns_1_2017_2018=p_2018_1+p_2018_1-p_2017_1
ns_2_2017_2018=p_2018_2+p_2018_2-p_2017_2
ns_3_2017_2018=p_2018_3+p_2018_3-p_2017_3
ns_4_2017_2018=p_2018_4+p_2018_4-p_2017_4
ns_5_2017_2018=p_2018_5+p_2018_5-p_2017_5
ns_6_2017_2018=p_2018_6+p_2018_6-p_2017_6
ns_7_2017_2018=p_2018_7+p_2018_7-p_2017_7
ns_8_2017_2018=p_2018_8+p_2018_8-p_2017_8
ns_9_2017_2018=p_2018_9+p_2018_9-p_2017_9
ns_10_2017_2018=p_2018_10+p_2018_10-p_2017_10
ns_11_2017_2018=p_2018_11+p_2018_11-p_2017_11
ns_12_2017_2018=p_2018_12+p_2018_12-p_2017_12
```
#Plotting niche shift between 2010 to 2011
```{r}
plot(ns_1_2010_2011,col=cl(4),main="Shift in Niche for January 2010 to 2011")
plot(wrld_simpl,add=T)
plot(ns_2_2010_2011,col=cl(4),main="Shift in Niche for February 2010 to 2011")
plot(wrld_simpl,add=T)
plot(ns_3_2010_2011,col=cl(4),main="Shift in Niche for March 2010 to 2011")
plot(wrld_simpl,add=T)
plot(ns_4_2010_2011,col=cl(4),main="Shift in Niche for April 2010 to 2011")
plot(wrld_simpl,add=T)
plot(ns_5_2010_2011,col=cl(4),main="Shift in Niche for May 2010 to 2011")
plot(wrld_simpl,add=T)
plot(ns_6_2010_2011,col=cl(4),main="Shift in Niche for June 2010 to 2011")
plot(wrld_simpl,add=T)
plot(ns_7_2010_2011,col=cl(4),main="Shift in Niche for July 2010 to 2011")
plot(wrld_simpl,add=T)
plot(ns_8_2010_2011,col=cl(4),main="Shift in Niche for August 2010 to 2011")
plot(wrld_simpl,add=T)
plot(ns_9_2010_2011,col=cl(4),main="Shift in Niche for September 2010 to 2011")
plot(wrld_simpl,add=T)
plot(ns_10_2010_2011,col=cl(4),main="Shift in Niche for October 2010 to 2011")
plot(wrld_simpl,add=T)
plot(ns_11_2010_2011,col=cl(4),main="Shift in Niche for November 2010 to 2011")
plot(wrld_simpl,add=T)
plot(ns_12_2010_2011,col=cl(4),main="Shift in Niche for December 2010 to 2011")
plot(wrld_simpl,add=T)
```
#Plotting niche shift for 2011 to 2012
```{r}
plot(ns_1_2011_2012,col=cl(4),main="Shift in Niche for January 2011 to 2012")
plot(wrld_simpl,add=T)
plot(ns_2_2011_2012,col=cl(4),main="Shift in Niche for February 2011 to 2012")
plot(wrld_simpl,add=T)
plot(ns_3_2011_2012,col=cl(4),main="Shift in Niche for March 2011 to 2012")
plot(wrld_simpl,add=T)
plot(ns_4_2011_2012,col=cl(4),main="Shift in Niche for April 2011 to 2012")
plot(wrld_simpl,add=T)
plot(ns_5_2011_2012,col=cl(4),main="Shift in Niche for May 2011 to 2012")
plot(wrld_simpl,add=T)
plot(ns_6_2011_2012,col=cl(4),main="Shift in Niche for June 2011 to 2012")
plot(wrld_simpl,add=T)
plot(ns_7_2011_2012,col=cl(4),main="Shift in Niche for July 2011 to 2012")
plot(wrld_simpl,add=T)
plot(ns_8_2011_2012,col=cl(4),main="Shift in Niche for August 2011 to 2012")
plot(wrld_simpl,add=T)
plot(ns_9_2011_2012,col=cl(4),main="Shift in Niche for September 2011 to 2012")
plot(wrld_simpl,add=T)
plot(ns_10_2011_2012,col=cl(4),main="Shift in Niche for October 2011 to 2012")
plot(wrld_simpl,add=T)
plot(ns_11_2011_2012,col=cl(4),main="Shift in Niche for November 2011 to 2012")
plot(wrld_simpl,add=T)
plot(ns_12_2011_2012,col=cl(4),main="Shift in Niche for December 2011 to 2012")
plot(wrld_simpl,add=T)

```
#Niche Shift for 2012 to 2013
```{r}
plot(ns_1_2012_2013,col=cl(4),main="Shift in Niche for January 2012 to 2013")
plot(wrld_simpl,add=T)
plot(ns_2_2012_2013,col=cl(4),main="Shift in Niche for February 2012 to 2013")
plot(wrld_simpl,add=T)
plot(ns_3_2012_2013,col=cl(4),main="Shift in Niche for March 2012 to 2013")
plot(wrld_simpl,add=T)
plot(ns_4_2012_2013,col=cl(4),main="Shift in Niche for April 2012 to 2013")
plot(wrld_simpl,add=T)
plot(ns_5_2012_2013,col=cl(4),main="Shift in Niche for May 2012 to 2013")
plot(wrld_simpl,add=T)
plot(ns_6_2012_2013,col=cl(4),main="Shift in Niche for June 2012 to 2013")
plot(wrld_simpl,add=T)
plot(ns_7_2012_2013,col=cl(4),main="Shift in Niche for July 2012 to 2013")
plot(wrld_simpl,add=T)
plot(ns_8_2012_2013,col=cl(4),main="Shift in Niche for August 2012 to 2013")
plot(wrld_simpl,add=T)
plot(ns_9_2012_2013,col=cl(4),main="Shift in Niche for September 2012 to 2013")
plot(wrld_simpl,add=T)
plot(ns_10_2012_2013,col=cl(4),main="Shift in Niche for October 2012 to 2013")
plot(wrld_simpl,add=T)
plot(ns_11_2012_2013,col=cl(4),main="Shift in Niche for November 2012 to 2013")
plot(wrld_simpl,add=T)
plot(ns_12_2012_2013,col=cl(4),main="Shift in Niche for December 2012 to 2013")
plot(wrld_simpl,add=T)
```

#Niche Shift for 2013 to 2014
```{r}
plot(ns_1_2013_2014,col=cl(4),main="Shift in Niche for January 2013 to 2014")
plot(wrld_simpl,add=T)
plot(ns_2_2013_2014,col=cl(4),main="Shift in Niche for February 2013 to 2014")
plot(wrld_simpl,add=T)
plot(ns_3_2013_2014,col=cl(4),main="Shift in Niche for March 2013 to 2014")
plot(wrld_simpl,add=T)
plot(ns_4_2013_2014,col=cl(4),main="Shift in Niche for April 2013 to 2014")
plot(wrld_simpl,add=T)
plot(ns_5_2013_2014,col=cl(4),main="Shift in Niche for May 2013 to 2014")
plot(wrld_simpl,add=T)
plot(ns_6_2013_2014,col=cl(4),main="Shift in Niche for June 2013 to 2014")
plot(wrld_simpl,add=T)
plot(ns_7_2013_2014,col=cl(4),main="Shift in Niche for July 2013 to 2014")
plot(wrld_simpl,add=T)
plot(ns_8_2013_2014,col=cl(4),main="Shift in Niche for August 2013 to 2014")
plot(wrld_simpl,add=T)
plot(ns_9_2013_2014,col=cl(4),main="Shift in Niche for September 2013 to 2014")
plot(wrld_simpl,add=T)
plot(ns_10_2013_2014,col=cl(4),main="Shift in Niche for October 2013 to 2014")
plot(wrld_simpl,add=T)
plot(ns_11_2013_2014,col=cl(4),main="Shift in Niche for November 2013 to 2014")
plot(wrld_simpl,add=T)
plot(ns_12_2013_2014,col=cl(4),main="Shift in Niche for December 2013 to 2014")
plot(wrld_simpl,add=T)
```

#Niche Shift for 2014 to 2015
```{r}
plot(ns_1_2014_2015,col=cl(4),main="Shift in Niche for January 2014 to 2015")
plot(wrld_simpl,add=T)
plot(ns_2_2014_2015,col=cl(4),main="Shift in Niche for February 2014 to 2015")
plot(wrld_simpl,add=T)
plot(ns_3_2014_2015,col=cl(4),main="Shift in Niche for March 2014 to 2015")
plot(wrld_simpl,add=T)
plot(ns_4_2014_2015,col=cl(4),main="Shift in Niche for April 2014 to 2015")
plot(wrld_simpl,add=T)
plot(ns_5_2014_2015,col=cl(4),main="Shift in Niche for May 2014 to 2015")
plot(wrld_simpl,add=T)
plot(ns_6_2014_2015,col=cl(4),main="Shift in Niche for June 2014 to 2015")
plot(wrld_simpl,add=T)
plot(ns_7_2014_2015,col=cl(4),main="Shift in Niche for July 2014 to 2015")
plot(wrld_simpl,add=T)
plot(ns_8_2014_2015,col=cl(4),main="Shift in Niche for August 2014 to 2015")
plot(wrld_simpl,add=T)
plot(ns_9_2014_2015,col=cl(4),main="Shift in Niche for September 2014 to 2015")
plot(wrld_simpl,add=T)
plot(ns_10_2014_2015,col=cl(4),main="Shift in Niche for October 2014 to 2015")
plot(wrld_simpl,add=T)
plot(ns_11_2014_2015,col=cl(4),main="Shift in Niche for November 2014 to 2015")
plot(wrld_simpl,add=T)
plot(ns_12_2014_2015,col=cl(4),main="Shift in Niche for December 2014 to 2015")
plot(wrld_simpl,add=T)
```

#Niche Shift for 2015 to 2016
```{r}
plot(ns_1_2015_2016,col=cl(4),main="Shift in Niche for January 2015 to 2016")
plot(wrld_simpl,add=T)
plot(ns_2_2015_2016,col=cl(4),main="Shift in Niche for February 2015 to 2016")
plot(wrld_simpl,add=T)
plot(ns_3_2015_2016,col=cl(4),main="Shift in Niche for March 2015 to 2016")
plot(wrld_simpl,add=T)
plot(ns_4_2015_2016,col=cl(4),main="Shift in Niche for April 2015 to 2016")
plot(wrld_simpl,add=T)
plot(ns_5_2015_2016,col=cl(4),main="Shift in Niche for May 2015 to 2016")
plot(wrld_simpl,add=T)
plot(ns_6_2015_2016,col=cl(4),main="Shift in Niche for June 2015 to 2016")
plot(wrld_simpl,add=T)
plot(ns_7_2015_2016,col=cl(4),main="Shift in Niche for July 2015 to 2016")
plot(wrld_simpl,add=T)
plot(ns_8_2015_2016,col=cl(4),main="Shift in Niche for August 2015 to 2016")
plot(wrld_simpl,add=T)
plot(ns_9_2015_2016,col=cl(4),main="Shift in Niche for September 2015 to 2016")
plot(wrld_simpl,add=T)
plot(ns_10_2015_2016,col=cl(4),main="Shift in Niche for October 2015 to 2016")
plot(wrld_simpl,add=T)
plot(ns_11_2015_2016,col=cl(4),main="Shift in Niche for November 2015 to 2016")
plot(wrld_simpl,add=T)
plot(ns_12_2015_2016,col=cl(4),main="Shift in Niche for December 2015 to 2016")
plot(wrld_simpl,add=T)
```

#Niche Shift for 2016 to 2017
```{r}
plot(ns_1_2016_2017,col=cl(4),main="Shift in Niche for January 2016 to 2017")
plot(wrld_simpl,add=T)
plot(ns_2_2016_2017,col=cl(4),main="Shift in Niche for February 2016 to 2017")
plot(wrld_simpl,add=T)
plot(ns_3_2016_2017,col=cl(4),main="Shift in Niche for March 2016 to 2017")
plot(wrld_simpl,add=T)
plot(ns_4_2016_2017,col=cl(4),main="Shift in Niche for April 2016 to 2017")
plot(wrld_simpl,add=T)
plot(ns_5_2016_2017,col=cl(4),main="Shift in Niche for May 2016 to 2017")
plot(wrld_simpl,add=T)
plot(ns_6_2016_2017,col=cl(4),main="Shift in Niche for June 2016 to 2017")
plot(wrld_simpl,add=T)
plot(ns_7_2016_2017,col=cl(4),main="Shift in Niche for July 2016 to 2017")
plot(wrld_simpl,add=T)
plot(ns_8_2016_2017,col=cl(4),main="Shift in Niche for August 2016 to 2017")
plot(wrld_simpl,add=T)
plot(ns_9_2016_2017,col=cl(4),main="Shift in Niche for September 2016 to 2017")
plot(wrld_simpl,add=T)
plot(ns_10_2016_2017,col=cl(4),main="Shift in Niche for October 2016 to 2017")
plot(wrld_simpl,add=T)
plot(ns_11_2016_2017,col=cl(4),main="Shift in Niche for November 2016 to 2017")
plot(wrld_simpl,add=T)
plot(ns_12_2016_2017,col=cl(4),main="Shift in Niche for December 2016 to 2017")
plot(wrld_simpl,add=T)
```

#Niche Shift for 2017 to 2018
```{r}
plot(ns_1_2017_2018,col=cl(4),main="Shift in Niche for January 2017 to 2018")
plot(wrld_simpl,add=T)
plot(ns_2_2017_2018,col=cl(4),main="Shift in Niche for February 2017 to 2018")
plot(wrld_simpl,add=T)
plot(ns_3_2017_2018,col=cl(4),main="Shift in Niche for March 2017 to 2018")
plot(wrld_simpl,add=T)
plot(ns_4_2017_2018,col=cl(4),main="Shift in Niche for April 2017 to 2018")
plot(wrld_simpl,add=T)
plot(ns_5_2017_2018,col=cl(4),main="Shift in Niche for May 2017 to 2018")
plot(wrld_simpl,add=T)
plot(ns_6_2017_2018,col=cl(4),main="Shift in Niche for June 2017 to 2018")
plot(wrld_simpl,add=T)
plot(ns_7_2017_2018,col=cl(4),main="Shift in Niche for July 2017 to 2018")
plot(wrld_simpl,add=T)
plot(ns_8_2017_2018,col=cl(4),main="Shift in Niche for August 2017 to 2018")
plot(wrld_simpl,add=T)
plot(ns_9_2017_2018,col=cl(4),main="Shift in Niche for September 2017 to 2018")
plot(wrld_simpl,add=T)
plot(ns_10_2017_2018,col=cl(4),main="Shift in Niche for October 2017 to 2018")
plot(wrld_simpl,add=T)
plot(ns_11_2017_2018,col=cl(4),main="Shift in Niche for November 2017 to 2018")
plot(wrld_simpl,add=T)
plot(ns_12_2017_2018,col=cl(4),main="Shift in Niche for December 2017 to 2018")
plot(wrld_simpl,add=T)

```

#Common niche 2010-2018
```{r}
n_1=p_2010_1*p_2011_1*p_2012_1*p_2013_1*p_2014_1*p_2015_1*p_2016_1*p_2017_1*p_2018_1
n_2=p_2010_2*p_2011_2*p_2012_2*p_2013_2*p_2014_2*p_2015_2*p_2016_2*p_2017_2*p_2018_2
n_3=p_2010_3*p_2011_3*p_2012_3*p_2013_3*p_2014_3*p_2015_3*p_2016_3*p_2017_3*p_2018_3
n_4=p_2010_4*p_2011_4*p_2012_4*p_2013_4*p_2014_4*p_2015_4*p_2016_4*p_2017_4*p_2018_4
n_5=p_2010_5*p_2011_5*p_2012_5*p_2013_5*p_2014_5*p_2015_5*p_2016_5*p_2017_5*p_2018_5
n_6=p_2010_6*p_2011_6*p_2012_6*p_2013_6*p_2014_6*p_2015_6*p_2016_6*p_2017_6*p_2018_6
n_7=p_2010_7*p_2011_7*p_2012_7*p_2013_7*p_2014_7*p_2015_7*p_2016_7*p_2017_7*p_2018_7
n_8=p_2010_8*p_2011_8*p_2012_8*p_2013_8*p_2014_8*p_2015_8*p_2016_8*p_2017_8*p_2018_8
n_9=p_2010_9*p_2011_9*p_2012_9*p_2013_9*p_2014_9*p_2015_9*p_2016_9*p_2017_9*p_2018_9
n_10=p_2010_10*p_2011_10*p_2012_10*p_2013_10*p_2014_10*p_2015_10*p_2016_10*p_2017_10*p_2018_10
n_11=p_2010_11*p_2011_11*p_2012_11*p_2013_11*p_2014_11*p_2015_11*p_2016_11*p_2017_11*p_2018_11
n_12=p_2010_12*p_2011_12*p_2012_12*p_2013_12*p_2014_12*p_2015_12*p_2016_12*p_2017_12*p_2018_12
```

#Plotting common niche
```{r}
plot(n_1,main="Common Niche for January (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(n_2,main="Common Niche for February (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(n_3,main="Common Niche for March (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(n_4,main="Common Niche for April (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(n_5,main="Common Niche for May (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(n_6,main="Common Niche for June (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(n_7,main="Common Niche for July (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(n_8,main="Common Niche for August (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(n_9,main="Common Niche for September (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(n_10,main="Common Niche for October (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(n_11,main="Common Niche for November (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(n_12,main="Common Niche for December (2010 to 2018)")
plot(wrld_simpl,add=T)
```
#Common niche derived Origin and and Destination
```{r}
ns_1_2=n_2+n_2-n_1
ns_2_3=n_3+n_3-n_2
ns_3_4=n_4+n_4-n_3
ns_4_5=n_5+n_5-n_4
ns_5_6=n_6+n_6-n_5
ns_6_7=n_7+n_7-n_6
ns_7_8=n_8+n_8-n_7
ns_8_9=n_9+n_9-n_8
ns_9_10=n_10+n_10-n_9
ns_10_11=n_11+n_11-n_10
ns_11_12=n_12+n_12-n_11
ns_12_1=n_1+n_1-n_12
```

#Plotting Expected Origin and Destinations
```{r}
plot(ns_1_2,col=cl(4),main="Expected origin and Destination of February")
plot(wrld_simpl,add=T)
plot(ns_2_3,col=cl(4),main="Expected origin and Destination of March")
plot(wrld_simpl,add=T)
plot(ns_3_4,col=cl(4),main="Expected origin and Destination of April")
plot(wrld_simpl,add=T)
plot(ns_4_5,col=cl(4),main="Expected origin and Destination of May")
plot(wrld_simpl,add=T)
plot(ns_5_6,col=cl(4),main="Expected origin and Destination of June")
plot(wrld_simpl,add=T)
plot(ns_6_7,col=cl(4),main="Expected origin and Destination of July")
plot(wrld_simpl,add=T)
plot(ns_7_8,col=cl(4),main="Expected origin and Destination of August")
plot(wrld_simpl,add=T)
plot(ns_8_9,col=cl(4),main="Expected origin and Destination of September")
plot(wrld_simpl,add=T)
plot(ns_9_10,col=cl(4),main="Expected origin and Destination of October")
plot(wrld_simpl,add=T)
plot(ns_10_11,col=cl(4),main="Expected origin and Destination of November")
plot(wrld_simpl,add=T)
plot(ns_11_12,col=cl(4),main="Expected origin and Destination of December")
plot(wrld_simpl,add=T)
plot(ns_12_1,col=cl(4),main="Expected origin and Destination of January")
plot(wrld_simpl,add=T)
```
#Sum of all years niche
```{r}
total1=p_2010_1+p_2011_1+p_2012_1+p_2013_1+p_2014_1+p_2015_1+p_2016_1+p_2017_1+p_2018_1
total2=p_2010_2+p_2011_2+p_2012_2+p_2013_2+p_2014_2+p_2015_2+p_2016_2+p_2017_2+p_2018_2
total3=p_2010_3+p_2011_3+p_2012_3+p_2013_3+p_2014_3+p_2015_3+p_2016_3+p_2017_3+p_2018_3
total4=p_2010_4+p_2011_4+p_2012_4+p_2013_4+p_2014_4+p_2015_4+p_2016_4+p_2017_4+p_2018_4
total5=p_2010_5+p_2011_5+p_2012_5+p_2013_5+p_2014_5+p_2015_5+p_2016_5+p_2017_5+p_2018_5
total6=p_2010_6+p_2011_6+p_2012_6+p_2013_6+p_2014_6+p_2015_6+p_2016_6+p_2017_6+p_2018_6
total7=p_2010_7+p_2011_7+p_2012_7+p_2013_7+p_2014_7+p_2015_7+p_2016_7+p_2017_7+p_2018_7
total8=p_2010_8+p_2011_8+p_2012_8+p_2013_8+p_2014_8+p_2015_8+p_2016_8+p_2017_8+p_2018_8
total9=p_2010_9+p_2011_9+p_2012_9+p_2013_9+p_2014_9+p_2015_9+p_2016_9+p_2017_9+p_2018_9
total10=p_2010_10+p_2011_10+p_2012_10+p_2013_10+p_2014_10+p_2015_10+p_2016_10+p_2017_10+p_2018_10
total11=p_2010_11+p_2011_11+p_2012_11+p_2013_11+p_2014_11+p_2015_11+p_2016_11+p_2017_11+p_2018_11
total12=p_2010_12+p_2011_12+p_2012_12+p_2013_12+p_2014_12+p_2015_12+p_2016_12+p_2017_12+p_2018_12
```
#Plotting sum of niche

```{r}
cl=colorRampPalette(c("gray99","yellow","lightgoldenrod","gold1","chocolate2","pink3","violetred1","red3","yellowgreen","lightblue","slategrey","darkgreen","blue"))
plot(total1,main="Sum of Niche for January (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(total2,main="Sum of Niche for February (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(total3,main="Sum of Niche for March (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(total4,main="Sum of Niche for April (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(total5,main="Sum of Niche for May (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(total6,main="Sum of Niche for June (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(total7,main="Sum of Niche for July (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(total8,main="Sum of Niche for August (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(total9,main="Sum of Niche for September (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(total10,main="Sum of Niche for October (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(total11,main="Sum of Niche for November (2010 to 2018)")
plot(wrld_simpl,add=T)
plot(total12,main="Sum of Niche for December (2010 to 2018)")
plot(wrld_simpl,add=T)
```
#Expansion speed
```{r}
exp1=raster(total1)
exp1[]=ifelse(total1[]>=5,1,0)
exp2=raster(total2)
exp2[]=ifelse(total2[]>=5,1,0)
exp3=raster(total3)
exp3[]=ifelse(total3[]>=5,1,0)
exp4=raster(total4)
exp4[]=ifelse(total4[]>=5,1,0)
exp5=raster(total5)
exp5[]=ifelse(total5[]>=5,1,0)
exp6=raster(total6)
exp6[]=ifelse(total6[]>=5,1,0)
exp7=raster(total7)
exp7[]=ifelse(total7[]>=5,1,0)
exp8=raster(total8)
exp8[]=ifelse(total8[]>=5,1,0)
exp9=raster(total9)
exp9[]=ifelse(total9[]>=5,1,0)
exp10=raster(total9)
exp10[]=ifelse(total10[]>=5,1,0)
exp11=raster(total11)
exp11[]=ifelse(total11[]>=5,1,0)
exp12=raster(total12)
exp12[]=ifelse(total12[]>=5,1,0)
allexp=exp1+exp2+exp3+exp4+exp5+exp6+exp7+exp8+exp9+exp10+exp11+exp12

plot(allexp,col=cl(13), main="Amplitude of niche expansion")
plot(wrld_simpl,add=T)
```


#correlation
```{r}

cor1=corLocal(mig10,mig11,test=T)
cor1
ccor1=raster(mig10)
ccor1[]=ifelse(cor1$p.value[]<0.05,cor1$pearson[],NA);ccor1
ccor1[]=ifelse(ccor1[]<0.05,ccor1[],NA);ccor1
ccor1[]=ifelse(cor1$p.value[]>0.05,cor1$pearson[],ccor1[]);ccor1
crs(ccor1)=crs(wrld_simpl)

plot(ccor1,col=cm.colors(7))
plot(wrld_simpl,add=T)
library(raster)
#correlation_raster1=calc(mig10,mig11, fun=function(x, y){cor(x[], y[])})
cor(mig10[],mig11[])
cor2=corLocal(mig12,mig11,test=T)
cor2
ccor2=raster(mig12)
ccor2[]=ifelse(cor2$p.value[]<0.05,cor2$pearson[],NA);ccor2
ccor2[]=ifelse(ccor2[]<0.05,ccor2[],NA);ccor2
ccor2[]=ifelse(cor2$p.value[]>0.05,cor2$pearson[],ccor2[]);ccor2
crs(ccor2)=crs(wrld_simpl)
plot(ccor2,col=cm.colors(7))
plot(wrld_simpl,add=T)

cor3=corLocal(mig12,mig13,test=T)
cor3
ccor3=raster(mig12)
ccor3[]=ifelse(cor3$p.value[]<0.05,cor3$pearson[],NA);ccor3
ccor3[]=ifelse(ccor3[]<0.05,ccor3[],NA);ccor3
ccor3[]=ifelse(cor3$p.value[]>0.05,cor3$pearson[],ccor3[]);ccor3
crs(ccor3)=crs(wrld_simpl)
plot(ccor3,col=cm.colors(7))
plot(wrld_simpl,add=T)

cor4=corLocal(mig14,mig13,test=T)
cor4
ccor4=raster(mig14)
ccor4[]=ifelse(cor4$p.value[]<0.05,cor4$pearson[],NA);ccor4
ccor4[]=ifelse(ccor4[]<0.05,ccor4[],NA);ccor4
ccor4[]=ifelse(cor4$p.value[]>0.05,cor4$pearson[],ccor4[]);ccor4
crs(ccor4)=crs(wrld_simpl)
plot(ccor4,col=cm.colors(7))
plot(wrld_simpl,add=T)

cor5=corLocal(mig14,mig15,test=T)
cor5
ccor5=raster(mig14)
ccor5[]=ifelse(cor5$p.value[]<0.05,cor5$pearson[],NA);ccor5
ccor5[]=ifelse(ccor5[]<0.05,ccor5[],NA);ccor5
ccor5[]=ifelse(cor5$p.value[]>0.05,cor5$pearson[],ccor5[]);ccor5
crs(ccor5)=crs(wrld_simpl)
plot(ccor5,col=cm.colors(7))
plot(wrld_simpl,add=T)

cor6=corLocal(mig16,mig15,test=T)
cor6
ccor6=raster(mig16)
ccor6[]=ifelse(cor6$p.value[]<0.05,cor6$pearson[],NA);ccor6
ccor6[]=ifelse(ccor6[]<0.05,ccor6[],NA);ccor6
ccor6[]=ifelse(cor6$p.value[]>0.05,cor6$pearson[],ccor6[]);ccor6
crs(ccor6)=crs(wrld_simpl)
plot(ccor6,col=cm.colors(7))
plot(wrld_simpl,add=T)

cor7=corLocal(mig16,mig17,test=T)
cor7
ccor7=raster(mig16)
ccor7[]=ifelse(cor7$p.value[]<0.05,cor7$pearson[],NA);ccor7
ccor7[]=ifelse(ccor7[]<0.05,ccor7[],NA);ccor7
ccor7[]=ifelse(cor7$p.value[]>0.05,cor7$pearson[],ccor7[]);ccor7
crs(ccor7)=crs(wrld_simpl)
plot(ccor7,col=cm.colors(7))
plot(wrld_simpl,add=T)


cor8=corLocal(mig18,mig17,test=T)
cor8
ccor8=raster(mig18)
ccor8[]=ifelse(cor8$p.value[]<0.05,cor8$pearson[],NA);ccor8
ccor8[]=ifelse(ccor8[]<0.05,ccor8[],NA);ccor8
ccor8[]=ifelse(cor8$p.value[]>0.05,cor8$pearson[],ccor8[]);ccor8
crs(ccor8)=crs(wrld_simpl)
plot(ccor8,col=cm.colors(7))
plot(wrld_simpl,add=T)

```
#variance

```{r}
library(raster)
allmig=raster::brick(mig10,mig11,mig12,mig13,mig14,mig15,mig16,mig17,mig18)
Pval=matrix(NA,9,9);Fval=matrix(NA,9,9)
for (i in 1:9) {
  for (j in 1:9) {
     varval=var.test(allmig[[i]],allmig[[j]])
     Pval[i,j]=varval$p.value
     Fval[i,j]=varval$statistic
  }
}

Pval
colnames(Pval)= as.character(seq(2010,2018, length.out=9))
Fval
colnames(Fval)= as.character(seq(2010,2018, length.out=9))
heatmap(Fval)
rownames(Pval)=as.character(seq(2010,2018, length.out=9))
rownames(Fval)=as.character(seq(2010,2018, length.out=9))


library(ggplot2)
library(reshape2)
m_long <- melt(Fval)
ggplot(m_long, aes(x = Var2, y = Var1, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red",
                       midpoint = 0, name = "Values") +
  labs(title = "Heatmap indicating F values of yearwise variation in niches",
       x = "Years", y = "Years")


m_long <- melt(Pval)
ggplot(m_long, aes(x = Var2, y = Var1, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red",
                       midpoint = 0, name = "Values") +
  labs(title = "Heatmap indicating P values of yearwise variation in niches using F-test",
       x = "Years", y = "Years")

```



```{r}
for (i in 1:9) {
for (j in 1:9) {
  polygons1 <- rasterToPolygons(allmig[[i]])
polygons2 <- rasterToPolygons(raster[[j]])
intersectedPolygons <- intersect(polygons1, polygons2)
values1 <- extract(allmig[[i]], intersectedPolygons)
values2 <- extract(allmig[[i]], intersectedPolygons)
variance <- calc(intersectedPolygons, function(x) var(c(x[,i], x[,j])))

}  
}
polygons1 <- rasterToPolygons(allmig[[i]])
polygons2 <- rasterToPolygons(raster[[j]])
intersectedPolygons <- intersect(polygons1, polygons2)
values1 <- extract(allmig[[i]], intersectedPolygons)
values2 <- extract(allmig[[i]], intersectedPolygons)
variance <- calc(intersectedPolygons, function(x) var(c(x[,i], x[,j])))
```











